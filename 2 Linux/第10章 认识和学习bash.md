# 第10章 认识和学习bash

## 查询命令是否为bash shell

`type [-tpa] name`查询命令。

- `-t`表示用file、alias、builtin表示其命令。
- `-p`表示那么为外部命令时的文件名。
- `-a`在PATH定义的路径中把所有含那么的命令都列出来。

- `Ctrl+U` 删除前边字符串
- `Ctrl+k` 删除后边字符串

## 变量

环境变量：`PATH`、`HOME`、`MAIL`、`SHELL`等。一般自定义变量用小写来表示。

使用环境变量的值一般为：`$变量`或`${变量}`

定义或使用某个变量的方法：等号连接（右边有空格的可以用引号连接起来）

双引号内的`$`字符可以保持原有的特性，单引号内的字符保持原有字符。

其他：

- 需要使用其他命令执行的，可以用反单引号或$(命令)：
  
  ```bash
  ➜  ~ mytest="test $(uname -r )"
  ➜  ~ echo $mytest
  test 5.15.39-1-pve
  ```

- 扩增变量内容：用`${变量}`或`"$变量名称"`表示。
- 取消变量为`unset 变量名`
- 使用ramdom获得0-9的数值
  
  ```bash
  ➜  ~ declare -i number=$RANDOM*10/32768; echo $number
  4
  ```

## 重要的变量

- `PS1` 提示字符的设置
- `$` 本shell的PID
- `?` 上一个命令的返回值
- `OSTYPE`，`HOSTTIPE`，`MACHTYPE` 表示主机硬件和内核的等级

`export`可以将自定义变量转为环境变量，可以被子进程所继承。

## 读入变量

`read -[pt] variable`读入内容存入变量`variable`中。

- `-p`后接提示字符
- `-t`后接等待时间

`declare`和`typeset`是一样的功能，就是声明变量的类型。

- `declare -[aixr] variable`
  - 其中a为数组（下标从1开始）
  - i为整数
  - x和export一样是定义为环境变量
  - r定义为read-only且不可unset
  - `-`改成`+`可以减去这个属性

另：ulimit命令可以对用户作出限制。

## 变量的替换

- `${变量#关键词}`若变量内容从头开始的数据符合关键词，则将符合的最短删除
- `${变量##关键词}`删除最长的
- `${变量%(%%)关键词}`从尾
- `${变量/旧字符串/新字符串}`替换第一个
- `${变量//旧字符串/新字符串}`全部替换

## bash的环境配置文件

### login 与 non-login shell

- `login shell` ：取得bash时需要完整的登录流程
- `non-login shell` ：取得bash不需要重复登录的操作
- `source` 读入配置文件而不用重新登录

## 终端的环境设置

用 `stty` 查看按键代表的意义。

通配符和特殊符号

- `&` 命令变成后台任务
- 两个\`中间为可以先执行的命令，也就是 `$`
- `()` 为子shell的起始与结束
- `{}` 为命令区块的组合

## 管道命令

能接受标准输入的是管道命令，比如less、more、head、tail等。ls等不属于管道命令。

- `cut` 获取切片
  - `cut -d '分隔字符' -f fields` 分割出第几段。
  - `cut -c 字符区间` 对每一行取得某个字符区间.
- `grep` 分析每一行的信息，如果有则拿出来
  - `grep -c` 查找成功的次数
  - `grep -n` 顺便输出行号
  - `grep -i` 忽略大小写
  - `grep -v` 反向选择
- `sort` 排序
  - `-t '分隔字符'` 使用分隔字符
  - `-f` 忽略大小写差异
  - `-n` 使用纯数字排序
  - `-b` 忽略前边的空白字符
- `uniq` 把连续重复数据只显示一个
  - `-c` 显示重复了多少次
  - `-i` 忽略大小写差异
- `wc` 字符计数，输出为：行、字数、字符数。
- `tee` 双向定向，输入同时输出到文件和屏幕
  - `tee -a` 追加到文件末尾
