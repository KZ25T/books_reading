# 第5章 Linux的文件权限与目录配置

## 用户与用户组

文件拥有者：可以设置文件的权限

用户组：用户分组，可以将一个计算机内的用户分为几个团队进行管理。每个账号可以有多个用户组的支持。（共享客厅、自己的卧室）

在Linux里，每个文件都具有用户、所属群组和其他人三种身份的个别权限。

## 文件权限

```bash
root@VMxxxx-xxxx:~# ls -al
总用量 56
drwx------  7 root root  4096 9月   6 18:09 .
drwxr-xr-x 25 root root  4096 9月   6 19:50 ..
drwxr-xr-x  2 root root  4096 3月  22 21:18 模板
drwxr-xr-x  2 root root  4096 3月  22 21:18 桌面
-rw-------  1 root root  1655 9月   6 20:08 .bash_history
-rw-r--r--  1 root root  3770 10月  2  2021 .bashrc
drwx------  3 root root  4096 4月  13 19:34 .cache
drwx------  3 root root  4096 9月   6  2020 .config
-rw-r--r--  1 root root   877 9月   5  2020 .profile
-rw-------  1 root root 11806 9月   6 18:09 .viminfo
drwxr-xr-x  2 root root  4096 9月   6 13:21 .vscode
-rw-r--r--  1 root root   165 4月  30 10:32 .wget-hsts
```

格式为：\[权限]\[链接]\[拥有者]\[用户组]\[文件容量]\[修改日期]\[文件名]

其中文件权限：

- 第一个字符代表文件是目录、文件等。
  - `[d]` 目录
  - `[-]` 文件
  - `[l]` 链接文件
  - `[b]` 设备文件中可按块随机读写的设备
  - `[c]` 串口设备，比如鼠标键盘等一次性读写设备
- 接下来的字符三个为一组，均为`[rwx]`的组合。`[r]`代表可读、`[w]`代表可写、`[x]`代表可执行。没有权限就显示`-`号。
  - 第一组为文件拥有者
  - 第二组为加入此用户组账号的权限
  - 第三组为非本人且没有加入本用户组的其他账号的权限

## 修改文件属性和权限

### chrgp：修改文件所属用户组

格式：`chgrp [-R] dirname`，其中`-R`表示递归。

### chowm：修改文件拥有者

格式：`chown [-R] 账号名称 dirname`，其实还可以顺便改了用户组，格式为`账号名称:用户组名称`。

### chmod：修改文件权限

格式：`chmod [-R] xyz dirname`，xyz表示拥有者、用户组、其他人的权限，4为r、2为w、1为x权限。

## 权限对目录的重要性

- r权限可以查看目录内容但无法进入目录。（当目录不属于用户本身时，查看文件名一堆问号）
- w可以修改目录结构，在目录中新建目录和文件。删除目录内文件或目录时不用管其权限是什么。
- x代表用户可否进入该目录成为工作目录。

注：

- 没有r权限没法读取目录（摸黑），不能列出目录下文件，但是可以进去，tab无法补全文件名，如果自己知道则可以编辑。
- 读取目录内文件至少需要rx权限。

## Linux的设备种类与扩展名

### 常规文件

属性以`-`开头。

- 纯文本文件
- 二进制文件
- 数据文件（比如`/var/log/wtmp`，只有特定指令能读取）

### 目录

`d`开头。

### 链接文件

类似于win的快捷方式，第一个属性为`l`格式。

### 设备与设备文件

- 区块设备文件：随机读取接口设备，比如硬盘，属性为`b`
- 字符设备文件：即一些串口设备，比如键盘鼠标等，属性为`c`

### 数据接口文件

一般用于网络上的数据交换，第一个属性为`s`，最长在`/run`或`/tmp`中看到。

### 数据输送文件

主要解决多个程序同时读写一个文件造成的错误问题，属性为`p`开头。

Linux的文件能否被执行与扩展名无关，与属性x有关。

## Linux的目录配置依据：FHS

FHS将目录定义为四种交互作用的形态：不便、可变、可分享、不可分享。

三层目录定义：

- `/`，根目录，与系统启动有关
- `/usr`，与软件安装、执行有关
- `/var`，与系统运行过程有关

FHS要求必须存在的目录：

- `/bin`：系统执行文件，比如`cat`等命令。
- `/boot`：启动用文件，包括Linux内核文件
- `/dev`：任何设备与设备接口都在这里，读写文件等于读写设备。
- `/etc`：系统重要配置文件，比如密码、服务启动文件等。

  一般普通用户可查看，但只有root能修改。

  `/etc/opt`（必要）：第三方辅助软件的相关配置文件。

- `/lib`：启动时调用的函数库，以及在`/bin`下面的命令会调用的函数库。

  `/lib/modules`：可抽换式内核相关模块（驱动程序）

- `/media`：软盘、光盘挂载于此。
- `/mnt`：暂时挂载某些额外设备。
- `/opt`：第三方辅助软件安装目录。
- `/run`：系统启动后产生的各项信息，可以使用内存来模拟。
- `/sbin`：启动过程中所需要的
- `/srv`：一些网络服务启动之后需要使用的数据目录。
- `/tmp`：一般用户或正在执行的程序暂时放置文件的地方。

建议存在的目录：

- `/home`：新建一个一般账户时的家目录。
- `/lib<qual>`：与lib不同格式的库。
- `/root`：系统管理员的家目录。

几个同样重要的目录：

- `/lost+found`：标准ext2-4才会产生的目录，当文件系统发生错误时将一些遗失片段放在这里。
- `/proc`：虚拟文件系统，在内存中，不占任何硬盘空间。
- `/sys`：类似的虚拟文件系统，记录内核与系统硬件信息相关的内容。

五个目录需要和根目录放置在一起：/etc、/bin、/dev、/lib和/sbin五个。

### `/usr`目录的内容

`/usr`中的数据属于可分享不可变动。usr其实是UNIX Software Resource的缩写。

FHS建议软件开发者将软件内容合理放置在这个目录下的子目录，而不是建立自己的目录。一般会占有最多的磁盘容量。

`/usr`中必须存在：

- `/usr/bin`：一般用户能使用的命令
- `/usr/lib`：与`/lib`功能相同
- `/usr/local`：系统管理员在本季安装自己下载的软件
- `/usr/sbin`：非系统正常运行需要的命令
- `/usr/share`：只读数据文件，包括一些共享文件

建议存在的目录：

- `/usr/games`：与游戏相关
- `/usr/include`：C/C++等的头文件存放处
- `/usr/libexec`：某些不被一般用户常用的执行文件或脚本
- `/usr/lib<qual>`：与`/lib<qual>`功能相同
- `/usr/src`：一般源代码建议放置到这里

### `/var`目录的内容

`/var`目录主要针对经常变动的文件，包括缓存、日志文件和一些软件运行产生的文件，包括程序文件或者MySQL数据库文件等。

必须存在的目录：

- `/var/cache`：程序本身运行过程中产生的缓存
- `/var/lib`：程序执行过程中需要使用的数据文件
- `/var/lock`：上锁的文件资源，不能被多用户同时使用
- `/var/log`：日志文件存放的目录
- `/var/mail`：放置个人电子邮箱的目录
- `/var/run`：程序PID的目录
- `/var/spoll`：放置一些队列数据
