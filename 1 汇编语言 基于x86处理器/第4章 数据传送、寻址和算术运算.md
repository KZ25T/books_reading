# 第四章 数据传送、寻址和算术运算

## 整数的扩展

整数的扩展可以使用MOVZX和MOVSX两种指令。

- MOVZX
  MOVZX把整数全领扩展，8/16→32，8→16两种。
- MOVSX
  MOVSX把整数进行符号扩展并传送。
- LAHF
  LAHF把EFLAGS的低字节复制到AH
- SAHF
  SAHF是LAHF的逆操作。
- XCHG
  XCHG交换两个操作数的内容。

## 加法和减法

整数的加减法：

- INC和DEC
  这个指令可以作用于寄存器或内存，不影响进位标志位。
  
  【注】经本人实验验证，对于内存操作，如果使用寄存器间接寻址，则需要指定大小，否则不能通过汇编。

- ADD和SUB
  要求指令操作数长度相同。

- NEG指令
  对操作数取反加一。

## 加减法影响标志位

- 进位：无符号溢出
- 溢出：有符号溢出
- 零：运算结果为0
- 符号：有符号运算产生负数
- 奇偶标志位：最低字节二进制1的个数
- 辅助进位：最低有效字节中位3有进位

## 数据相关的运算符和伪指令

- OFFSET
  OFFSET运算符返回数据标号的偏移量。
- ALIGN
  内存对齐。
- PTR
  设置大小属性。
- TYPE
  返回单个元素的大小。
- LENGTHOF
  返回同一行数组的大小。（在结尾用逗号可以延伸到下一行）
- SIZEOF
  返回数组所占的内存大小（TYPE和LENGTHOF的乘积）
- LABEL
  可以插入一个标号并定义其大小属性，与其他的共享内存位置，但是自身不分配内存。

## 间接寻址

间接寻址可以使用\[寄存器]或者 常数\[寄存器]这样的模式。

在实地址模式中，一般使用16位寄存器作为变址操作数，能用的只有SI、DI、BX和BP；如果有间接操作数，则应避免使用BP，除非是堆栈寻址。

计算偏移量可以使用比例银子，比如

```asm
.data
arrayD DD 1,2,3,4
.code
mov esi,3
mov eax,arrayD[esi*4]
```

也可以使用TYPE运算符。

### 指针

指针可以使用DWORD保存，也可以使用typedef创建一种指针类型。
